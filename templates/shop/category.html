{% extends 'base.html' %}
{% load static %}

{% block content %}
<h1>Nos {{ category.name|title }}</h1>



<div class="category-grid">
    {% for product in products %}
    <div class="category-item">
        <div class="category-image">
            <img src="{{ product.image.url }}" alt="Image de {{ product.name }}">
        </div>
        <div class="category-info">
            <h3>{{ product.name }}</h3>
            <p>{{ product.description }}</p>
            <p class="price">{{ product.price }} €</p>
        </div>

        {% if user.is_authenticated %}
            <div class="button-container">
                <button type="button" onclick="addToCart('{{ product.slug }}')">Ajouter au panier</button>
            </div>
        {% endif %}

    </div>
    {% empty %}
    <p>Aucun produit disponible dans cette catégorie.</p>
    {% endfor %}
</div>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f7f7f7;
    }

    h1 {
        text-align: center;
        padding: 20px;
        color: #ff9800;
        font-size: 3rem;
        margin-bottom: 40px;
    }

    .category-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        padding: 0 20px;
    }

    .category-item {
        display: flex; /* Ajouté pour utiliser Flexbox */
        flex-direction: column; /* Colonne pour aligner les éléments verticalement */
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        width: 300px;
        transition: transform 0.3s;
        opacity: 0;
        transform: translateY(50px);
    }

    .category-item:hover {
        transform: scale(1.05);
    }

    .category-image img {
        display: block; /* Changer à 'block' pour éviter les espaces indésirables */
        width: 100%;
        max-height: 250px;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
    }

    .category-info {
        padding: 20px;
        text-align: center;
        flex-grow: 1; /* Permet au contenu d'occuper tout l'espace disponible */
    }

    .category-info h3 {
        font-size: 1.5rem;
        color: #333;
    }

    .category-info p {
        color: #777;
        font-size: 1rem;
    }

    .price {
        font-size: 1.2rem;
        color: #ff9800;
        margin-top: 10px;
    }

    .button-container {
        margin-top: auto; /* Pousse le bouton vers le bas */
        padding: 20px; /* Ajoute un peu d'espace autour du bouton */
        text-align: center; /* Centre le bouton */
    }

    .fade-in {
        opacity: 1;
        transform: translateY(0);
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const items = document.querySelectorAll('.category-item');
        let delay = 0;

        items.forEach(item => {
            setTimeout(() => {
                item.classList.add('fade-in');
            }, delay);
            delay += 200;
        });
    });

    function addToCart(slug) {
    const url = "{% url 'add_to_cart_view' slug='slug_placeholder' %}".replace('slug_placeholder', slug);
    fetch(url, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            let cartCountElement = document.getElementById('cart-count');
            if (cartCountElement) {
                cartCountElement.innerText = parseInt(cartCountElement.innerText) + 1;
            }

            // Afficher la notification
            const notification = document.getElementById('notification');
            notification.style.display = 'block'; // Affiche le message
            setTimeout(() => {
                notification.style.display = 'none'; // Cache le message après 3 secondes
            }, 3000);
        }
    })
    .catch(error => {
        console.error("Erreur dans la requête fetch :", error);
    });
}

</script>

{% endblock %}
